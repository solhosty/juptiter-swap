"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("jsbi"),e=require("decimal.js");function u(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=u(t),i=u(e);function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var u=0,r=new Array(e);u<e;u++)r[u]=t[u];return r}function n(t,e){var u="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(u)return(u=u.call(t)).next.bind(u);if(Array.isArray(t)||(u=function(t,e){if(t){if("string"==typeof t)return a(t,e);var u=Object.prototype.toString.call(t).slice(8,-1);return"Object"===u&&t.constructor&&(u=t.constructor.name),"Map"===u||"Set"===u?Array.from(t):"Arguments"===u||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u)?a(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){u&&(t=u);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l=r.default.BigInt(0),d=r.default.BigInt(1),o=r.default.BigInt(2);function f(t){return t.reduce((function(t,e){return r.default.add(t,e)}),l)}function s(t){return t.reduce((function(t,e){return r.default.multiply(t,e)}),d)}function c(t,e){var u=r.default.divide(t,e);if(r.default.equal(u,l))return[l,l];var i=r.default.remainder(t,e);return r.default.greaterThan(i,l)&&(u=r.default.add(u,d),e=r.default.divide(t,u),i=r.default.remainder(t,u),r.default.greaterThan(i,l)&&(e=r.default.add(e,d))),[u,e]}function p(t,e){return void 0===e&&(e=0),new i.default(t.toString()).div(new i.default(10).pow(e))}var h=function(){function t(t,e,u){this.numberOfCurrencies=void 0,this.amplificationFactor=void 0,this.targetPrices=void 0,this.numberOfCurrencies=t,this.amplificationFactor=e,this.targetPrices=u}var e=t.prototype;return e.exchange=function(t,e,u,i,a){if(void 0===a&&(a=!0),t.length!==r.default.toNumber(this.numberOfCurrencies))throw new Error("Number of currencies does not match");var n=this.xp(t),l=r.default.multiply(i,this.targetPrices[e]),o=r.default.add(n[e],l),f=this.computeY(t,e,u,o),s=r.default.subtract(n[u],f);return a&&(s=r.default.subtract(s,d)),r.default.divide(s,this.targetPrices[u])},e.computeBaseY=function(t,e,u,a){var n=this.computeD(t),l=this.xp(t),d=r.default.exponentiate(this.numberOfCurrencies,this.numberOfCurrencies),o=f(l),c=s(l),p=r.default.subtract(r.default.add(r.default.multiply(r.default.multiply(this.amplificationFactor,d),o),n),r.default.multiply(r.default.multiply(this.amplificationFactor,n),d)),h=r.default.multiply(r.default.multiply(r.default.multiply(this.amplificationFactor,d),d),c),m=r.default.multiply(r.default.multiply(d,c),p),g=r.default.add(h,r.default.divide(m,l[e])),v=r.default.add(h,r.default.divide(m,l[u])),O=Math.log10(r.default.toNumber(this.targetPrices[e])),b=Math.log10(r.default.toNumber(this.targetPrices[u])),y=Math.abs(b-O);return r.default.BigInt(O>=b?new i.default(g.toString()).mul(new i.default(a.toString())).div(new i.default(v.toString())).mul(Math.pow(10,y)).floor().toString():new i.default(g.toString()).mul(new i.default(a.toString())).div(new i.default(v.toString())).div(Math.pow(10,y)).floor().toString())},e.computeY=function(t,e,u,i){var a=this.computeD(t),s=this.xp(t);s[e]=i,s.splice(u,1);for(var c,p=r.default.multiply(this.amplificationFactor,this.numberOfCurrencies),h=a,m=n(s);!(c=m()).done;){var g=c.value;h=r.default.divide(r.default.multiply(h,a),r.default.multiply(g,this.numberOfCurrencies))}h=r.default.divide(r.default.multiply(h,a),r.default.multiply(this.numberOfCurrencies,p));for(var v=r.default.subtract(r.default.add(f(s),r.default.divide(a,p)),a),O=l,b=a,y=0;y<32;y++)if(O=b,b=r.default.divide(r.default.add(r.default.exponentiate(b,o),h),r.default.add(r.default.multiply(o,b),v)),r.default.greaterThan(b,O)){if(r.default.lessThanOrEqual(r.default.subtract(b,O),d))break}else if(r.default.lessThanOrEqual(r.default.subtract(O,b),d))break;return b},e.computeD=function(t){for(var e=l,u=this.xp(t),i=f(u),a=i,o=r.default.multiply(this.amplificationFactor,this.numberOfCurrencies),s=0;s<32;s++){for(var c,p=a,h=n(u);!(c=h()).done;){var m=c.value;p=r.default.divide(r.default.multiply(p,a),r.default.multiply(this.numberOfCurrencies,m))}e=a;var g=r.default.multiply(r.default.add(r.default.multiply(o,i),r.default.multiply(p,this.numberOfCurrencies)),a),v=r.default.add(r.default.multiply(r.default.subtract(o,d),a),r.default.multiply(r.default.add(this.numberOfCurrencies,d),p));if(a=r.default.divide(g,v),r.default.greaterThan(a,e)){if(r.default.lessThanOrEqual(r.default.subtract(a,e),d))break}else if(r.default.lessThanOrEqual(r.default.subtract(e,a),d))break}return a},e.xp=function(t){var e=this;return t.map((function(t,u){return r.default.multiply(t,e.targetPrices[u])}))},e.setAmplificationFactor=function(t){this.amplificationFactor=t},t}(),m=function(){function t(t,e,u,r){this.targetPrices=void 0,this.traderFee=void 0,this.curve=void 0,this.targetPrices=u,this.traderFee=r,this.curve=new h(t,e,this.targetPrices)}var e=t.prototype;return e.exchange=function(t,e,u,i){var a=this.getOutputAmount(t,e,u,i),n=this.getFees(a),l=r.default.subtract(a,n);return{priceImpact:this.getPriceImpact(t,e,l,u,i),fees:n,expectedOutputAmount:l}},e.getPriceImpact=function(t,e,u,a,n){if(r.default.equal(e,l)||r.default.equal(t[a],l)||r.default.equal(t[n],l))return new i.default(0);var d=p(this.getOutputAmountWithNoSlippage(t,e,a,n)),o=p(u);return d.sub(o).div(d)},e.getFees=function(t){return r.default.equal(this.traderFee.numerator,l)?l:r.default.divide(r.default.multiply(t,this.traderFee.numerator),this.traderFee.denominator)},e.getOutputAmount=function(t,e,u,r){return this.curve.exchange(t,u,r,e)},e.getOutputAmountWithNoSlippage=function(t,e,u,r){return this.curve.computeBaseY(t,u,r,e)},e.setAmp=function(t){this.curve.setAmplificationFactor(t)},e.setTraderFee=function(t){this.traderFee=t},t}();function g(t,e){if(r.default.equal(e.numerator,l)||r.default.equal(t,l))return l;var u=r.default.divide(r.default.multiply(t,e.numerator),e.denominator);return r.default.equal(u,l)?d:u}var v=function(){function t(t,e,u){this.traderFee=void 0,this.ownerFee=void 0,this.curve=void 0,this.traderFee=e,this.ownerFee=u,this.curve=new h(o,t,[d,d])}var e=t.prototype;return e.exchange=function(t,e,u){var r=0===u?1:0,i=this.getExpectedOutputAmount(t,e,r,u);return{priceImpact:this.getPriceImpact(t,e,i,r,u),fees:this.getFees(e),expectedOutputAmount:i}},e.getPriceImpact=function(t,e,u,a,n){if(r.default.equal(e,l)||r.default.equal(t[a],l)||r.default.equal(t[n],l))return new i.default(0);var d=p(this.getExpectedOutputAmountWithNoSlippage(t,e,a,n)),o=p(u);return d.sub(o).div(d)},e.getFees=function(t){var e=g(t,this.traderFee),u=g(t,this.ownerFee);return r.default.add(e,u)},e.getExpectedOutputAmount=function(t,e,u,r){var i=this.getInputAmountLessFees(e);return this.getOutputAmount(t,i,u,r)},e.getExpectedOutputAmountWithNoSlippage=function(t,e,u,r){var i=this.getInputAmountLessFees(e);return this.getOutputAmountWithNoSlippage(t,i,u,r)},e.getInputAmountLessFees=function(t){return r.default.subtract(t,this.getFees(t))},e.getOutputAmount=function(t,e,u,r){return this.curve.exchange(t,u,r,e,!1)},e.getOutputAmountWithNoSlippage=function(t,e,u,r){return this.curve.computeBaseY(t,u,r,e)},t}(),O=function(){function t(t,e,u){void 0===u&&(u=!0),this.traderFee=void 0,this.ownerFee=void 0,this.feesOnInput=void 0,this.traderFee=t,this.ownerFee=e,this.feesOnInput=u}var e=t.prototype;return e.exchange=function(t,e,u){var r=0===u?1:0,i=this.feesOnInput?this.getAmountLessFees(e):e,a=this.getExpectedOutputAmount(t,i,r,u),n=this.getFees(this.feesOnInput?e:a);return this.feesOnInput||(a=this.getAmountLessFees(a)),{priceImpact:this.getPriceImpact(t,i,a,r,u),fees:n,expectedOutputAmount:a}},e.exchangeForExactOutput=function(t,e,u){var r=0===u?1:0,i=this.feesOnInput?e:this.getAmountPlusFees(e),a=this.getInputAmount(t,i,r,u),n=this.getFees(this.feesOnInput?a:e);return this.feesOnInput&&(a=this.getAmountPlusFees(a)),{priceImpact:this.getPriceImpactExactOutput(t,a,i,r,u),fees:n,expectedInputAmount:a}},e.getPriceImpact=function(t,e,u,a,n){if(r.default.equal(e,l)||r.default.equal(t[a],l)||r.default.equal(t[n],l))return new i.default(0);var d=p(this.getExpectedOutputAmountWithNoSlippage(t,e,a,n)),o=p(u);return d.sub(o).div(d)},e.getPriceImpactExactOutput=function(t,e,u,a,n){if(r.default.equal(u,l)||r.default.equal(t[a],l)||r.default.equal(t[n],l))return new i.default(0);var d=p(this.getExpectedInputAmountWithNoSlippage(t,u,a,n));return p(e).sub(d).div(d)},e.getFees=function(t){var e=g(t,this.traderFee),u=g(t,this.ownerFee);return r.default.add(e,u)},e.getExpectedOutputAmount=function(t,e,u,r){return this.getOutputAmount(t,e,u,r)},e.getExpectedOutputAmountWithNoSlippage=function(t,e,u,i){if(r.default.equal(t[u],l))return t[i];var a=r.default.divide(r.default.multiply(e,t[i]),t[u]);return this.feesOnInput?a:this.getAmountLessFees(a)},e.getExpectedInputAmountWithNoSlippage=function(t,e,u,i){if(r.default.equal(t[i],l))return t[u];var a=r.default.divide(r.default.multiply(e,t[u]),t[i]);return this.feesOnInput?this.getAmountPlusFees(a):a},e.getAmountLessFees=function(t){return r.default.subtract(t,this.getFees(t))},e.getAmountPlusFees=function(t){return r.default.add(t,this.getFees(t))},e.getOutputAmount=function(t,e,u,i){var a=[t[u],t[i]],n=a[0],l=a[1],d=c(this.getInvariant(t),r.default.add(n,e));return r.default.subtract(l,d[0])},e.getInputAmount=function(t,e,u,i){var a=[t[u],t[i]],n=a[0],l=a[1],d=this.getInvariant(t);if(r.default.greaterThanOrEqual(e,l))throw new Error("Insufficient liquidity to provide outputTradeAmount");var o=c(d,r.default.subtract(l,e));return r.default.subtract(o[0],n)},e.getInvariant=function(t){return r.default.multiply(t[0],t[1])},t}(),b=function(t,e){this.numerator=void 0,this.denominator=void 0,this.numerator=t,this.denominator=e},y=new b(r.default.BigInt(0),r.default.BigInt(1));exports.Fraction=b,exports.ONE=d,exports.Stable=m,exports.TWO=o,exports.TokenSwapConstantProduct=O,exports.TokenSwapStable=v,exports.ZERO=l,exports.ZERO_FRACTION=y,exports.abs=function(t){return r.default.GE(t,l)?t:r.default.unaryMinus(t)},exports.calculateFeeAmount=g,exports.ceilingDivision=c,exports.mulArray=s,exports.sumArray=f,exports.toDecimal=p;
//# sourceMappingURL=math.cjs.production.min.js.map
