{"version":3,"sources":["../../ts/client/src/scripts/mb-add-spot-market.ts"],"sourcesContent":["import { AnchorProvider, Wallet } from '@project-serum/anchor';\nimport { Connection, Keypair, PublicKey } from '@solana/web3.js';\nimport * as dotenv from 'dotenv';\nimport fs from 'fs';\nimport { MangoClient } from '../client';\nimport { MANGO_V4_ID } from '../constants';\ndotenv.config();\n\n//\n// (untested?) script which closes a mango account cleanly, first closes all positions, withdraws all tokens and then closes it\n//\nasync function addSpotMarket() {\n  const options = AnchorProvider.defaultOptions();\n  const connection = new Connection(process.env.MB_CLUSTER_URL!, options);\n\n  // admin\n  const admin = Keypair.fromSecretKey(\n    Buffer.from(\n      JSON.parse(fs.readFileSync(process.env.MB_PAYER_KEYPAIR!, 'utf-8')),\n    ),\n  );\n  const adminWallet = new Wallet(admin);\n  const adminProvider = new AnchorProvider(connection, adminWallet, options);\n  const client = await MangoClient.connect(\n    adminProvider,\n    'mainnet-beta',\n    MANGO_V4_ID['mainnet-beta'],\n  );\n  console.log(`Admin ${admin.publicKey.toBase58()}`);\n\n  // fetch group\n  const groupPk = '78b8f4cGCwmZ9ysPFMWLaLTkkaYnUjwMJYStWe5RTSSX';\n  const group = await client.getGroup(new PublicKey(groupPk));\n  console.log(`Found group ${group.publicKey.toBase58()}`);\n\n  const eth_openbook_mkt = 'FZxi3yWkE5mMjyaZj6utmYL54QQYfMCKMcLaQZq4UwnA';\n  const eth_mint = '7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs';\n  const usdc_mint = 'EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v';\n\n  const signature = await client.serum3RegisterMarket(\n    group,\n    new PublicKey(eth_openbook_mkt),\n    group.getFirstBankByMint(new PublicKey(eth_mint)),\n    group.getFirstBankByMint(new PublicKey(usdc_mint)),\n    1, // market index\n    'ETH/USDC',\n  );\n\n  console.log('Tx Successful:', signature);\n\n  process.exit();\n}\n\nasync function main() {\n  await addSpotMarket();\n}\n\nmain();\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,SAAS,gBAAgB,cAAc;AACvC,SAAS,YAAY,SAAS,iBAAiB;AAC/C,YAAY,YAAY;AACxB,OAAO,QAAQ;AAGR,cAAO;AAKd,eAAe,gBAAgB;AAC7B,QAAM,UAAU,eAAe,eAAe;AAC9C,QAAM,aAAa,IAAI,WAAW,QAAQ,IAAI,gBAAiB,OAAO;AAGtE,QAAM,QAAQ,QAAQ;AAAA,IACpB,OAAO;AAAA,MACL,KAAK,MAAM,GAAG,aAAa,QAAQ,IAAI,kBAAmB,OAAO,CAAC;AAAA,IACpE;AAAA,EACF;AACA,QAAM,cAAc,IAAI,OAAO,KAAK;AACpC,QAAM,gBAAgB,IAAI,eAAe,YAAY,aAAa,OAAO;AACzE,QAAM,SAAS,MAAM,YAAY;AAAA,IAC/B;AAAA,IACA;AAAA,IACA,YAAY,cAAc;AAAA,EAC5B;AACA,UAAQ,IAAI,SAAS,MAAM,UAAU,SAAS,GAAG;AAGjD,QAAM,UAAU;AAChB,QAAM,QAAQ,MAAM,OAAO,SAAS,IAAI,UAAU,OAAO,CAAC;AAC1D,UAAQ,IAAI,eAAe,MAAM,UAAU,SAAS,GAAG;AAEvD,QAAM,mBAAmB;AACzB,QAAM,WAAW;AACjB,QAAM,YAAY;AAElB,QAAM,YAAY,MAAM,OAAO;AAAA,IAC7B;AAAA,IACA,IAAI,UAAU,gBAAgB;AAAA,IAC9B,MAAM,mBAAmB,IAAI,UAAU,QAAQ,CAAC;AAAA,IAChD,MAAM,mBAAmB,IAAI,UAAU,SAAS,CAAC;AAAA,IACjD;AAAA;AAAA,IACA;AAAA,EACF;AAEA,UAAQ,IAAI,kBAAkB,SAAS;AAEvC,UAAQ,KAAK;AACf;AAEA,eAAe,OAAO;AACpB,QAAM,cAAc;AACtB;AAEA,KAAK;","names":[]}