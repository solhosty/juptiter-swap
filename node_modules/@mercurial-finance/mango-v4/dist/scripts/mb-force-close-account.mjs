import {
  MangoClient
} from "../chunk-HVUWVEE5.mjs";
import "../chunk-PDNGNLHE.mjs";
import "../chunk-TSHDMTGJ.mjs";
import "../chunk-P2PWY3QH.mjs";
import "../chunk-TCNCMUFM.mjs";
import "../chunk-BYB3CFSH.mjs";
import "../chunk-36PUIGQD.mjs";
import {
  MANGO_V4_ID
} from "../chunk-5SDTDLZO.mjs";
import "../chunk-O3IXUKHU.mjs";
import "../chunk-62VGMIX5.mjs";
import "../chunk-34DSBDDD.mjs";
import "../chunk-FP7S2XO3.mjs";
import "../chunk-Z2RB6KEX.mjs";
import "../chunk-5VRACIDE.mjs";

// ts/client/src/scripts/mb-force-close-account.ts
import { AnchorProvider, Wallet } from "@project-serum/anchor";
import { Connection, Keypair, PublicKey } from "@solana/web3.js";
import fs from "fs";
var GROUP_NUM = Number(process.env.GROUP_NUM || 0);
var MANGO_ACCOUNT_PK = process.env.MANGO_ACCOUNT_PK;
var { MB_CLUSTER_URL, MB_PAYER_KEYPAIR, MB_USER_KEYPAIR, MB_USER4_KEYPAIR } = process.env;
async function buildUserClient(userKeypair) {
  const options = AnchorProvider.defaultOptions();
  const connection = new Connection(MB_CLUSTER_URL, options);
  const user = Keypair.fromSecretKey(
    Buffer.from(JSON.parse(fs.readFileSync(userKeypair, "utf-8")))
  );
  const userWallet = new Wallet(user);
  const userProvider = new AnchorProvider(connection, userWallet, options);
  const client = await MangoClient.connect(
    userProvider,
    "mainnet-beta",
    MANGO_V4_ID["mainnet-beta"]
  );
  const admin = Keypair.fromSecretKey(
    Buffer.from(JSON.parse(fs.readFileSync(MB_PAYER_KEYPAIR, "utf-8")))
  );
  console.log(`Admin ${admin.publicKey.toBase58()}`);
  const group = await client.getGroupForCreator(admin.publicKey, GROUP_NUM);
  return [client, group, user];
}
async function forceCloseUserAccount() {
  const result = await buildUserClient(MB_PAYER_KEYPAIR);
  const client = result[0];
  const group = result[1];
  const mangoAccount = await client.getMangoAccount(
    new PublicKey(MANGO_ACCOUNT_PK)
  );
  await client.closeMangoAccount(group, mangoAccount, true);
  process.exit();
}
async function main() {
  await forceCloseUserAccount();
}
main();
//# sourceMappingURL=mb-force-close-account.mjs.map