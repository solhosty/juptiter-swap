"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("promise-retry"),t=require("@solana/spl-token"),n=require("@solana/web3.js");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=o(e);class s extends Error{constructor(e,t,n){super(e),this.txid=void 0,this.code=void 0,this.txid=t,this.code=n,Object.setPrototypeOf(this,Error.prototype)}}const a="Unknown error, visit the explorer",i="So11111111111111111111111111111111111111112";async function c(e,o){const r=await t.Token.getAssociatedTokenAddress(t.ASSOCIATED_TOKEN_PROGRAM_ID,t.TOKEN_PROGRAM_ID,new n.PublicKey(i),o);return{address:r,accountInfo:await e.getAccountInfo(r)}}exports.TransactionError=s,exports.UNKNOWN_ERROR=a,exports.createAndTransferWSOLInstructions=async function(e,o,r){const s=await c(e,o),a=[];s.accountInfo||a.push(t.Token.createAssociatedTokenAccountInstruction(t.ASSOCIATED_TOKEN_PROGRAM_ID,t.TOKEN_PROGRAM_ID,new n.PublicKey(i),s.address,o,o)),a.push(n.SystemProgram.transfer({fromPubkey:o,toPubkey:s.address,lamports:r})),a.push(t.Token.createSyncNativeInstruction(t.TOKEN_PROGRAM_ID,s.address));const{blockhash:u,lastValidBlockHeight:l}=await e.getLatestBlockhash(),d=new n.Transaction({feePayer:o,blockhash:u,lastValidBlockHeight:l});return d.add(...a),d},exports.createUnwrapSolInstructions=async function(e,o){const r=await c(e,o),s=[];if(!r.accountInfo)return;s.push(t.Token.createCloseAccountInstruction(t.TOKEN_PROGRAM_ID,r.address,o,o,[]));const{blockhash:a,lastValidBlockHeight:i}=await e.getLatestBlockhash(),u=new n.Transaction({feePayer:o,blockhash:a,lastValidBlockHeight:i});return u.add(...s),u},exports.deserializeAccount=e=>{if(null==e||0==e.length)return;const o=t.AccountLayout.decode(e);return o.mint=new n.PublicKey(o.mint),o.owner=new n.PublicKey(o.owner),o.amount=t.u64.fromBuffer(o.amount),0===o.delegateOption?(o.delegate=null,o.delegatedAmount=new t.u64(0)):(o.delegate=new n.PublicKey(o.delegate),o.delegatedAmount=t.u64.fromBuffer(o.delegatedAmount)),o.isInitialized=0!==o.state,o.isFrozen=2===o.state,1===o.isNativeOption?(o.rentExemptReserve=t.u64.fromBuffer(o.isNative),o.isNative=!0):(o.rentExemptReserve=null,o.isNative=!1),o.closeAuthority=0===o.closeAuthorityOption?null:new n.PublicKey(o.closeAuthority),o},exports.deserializeMint=(e,o)=>{if(e.length!==t.MintLayout.span)return;const r=t.MintLayout.decode(e);return r.address=o,r.mintAuthority=0===r.mintAuthorityOption?null:new n.PublicKey(r.mintAuthority),r.supply=t.u64.fromBuffer(r.supply),r.isInitialized=0!==r.isInitialized,r.freezeAuthority=0===r.freezeAuthorityOption?null:new n.PublicKey(r.freezeAuthority),r},exports.parseErrorForTransaction=function(e){var t;const n=[];if(null!=e&&e.meta&&e.meta.logMessages&&e.meta.logMessages.forEach((e=>{const t=/Error: (.*)/gm;let o;for(;null!==(o=t.exec(e));)o.index===t.lastIndex&&t.lastIndex++,o.length>1&&n.push(o[1])})),n.length>0)return{message:n.join(",")};const o=null==e||null===(t=e.meta)||void 0===t?void 0:t.err;let r;if(o&&"string"!=typeof o){const t=o.InstructionError,[n,{Custom:i}]=t;if(r=null!=i?i:t[1],null!=e&&e.meta&&e.meta.logMessages){var s;const n=function(e,t){for(let n=0;n<e.length;n++){const o=e[n].match(new RegExp(`Program ([1-9A-HJ-NP-Za-km-z]{32,44}) failed: custom program error: 0x${t.toString(16)}`));if(o)return o[1]}}(null===(s=e.meta)||void 0===s?void 0:s.logMessages,r);if(n)return"11111111111111111111111111111111"===n?function(e){const t=e[1].Custom;let n="";switch(t){case 0:n="An account with the same address already exists";case 1:n="The account does not have enough SOL to perform the operation";default:n=a}return{code:t,programId:"11111111111111111111111111111111",message:n}}(t):{message:a,programId:n,code:r}}}return{message:"string"==typeof o?o:a,code:r}},exports.pollForConfirmedTransaction=async function(e,t){return r.default((async n=>{const o=await e.getTransaction(t,{commitment:"confirmed"});return o||n(new s("Transaction was not confirmed",t)),o}),{retries:30,minTimeout:500}).catch((()=>null))};
//# sourceMappingURL=optimist.cjs.production.min.js.map
