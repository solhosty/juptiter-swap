"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.calculateWithdrawableAmount = exports.getUnmintAmount = exports.getAmountByShare = void 0;
const bn_js_1 = __importDefault(require("bn.js"));
const constants_1 = require("../constants");
/**
 *
 * @param share - user's share
 * @param withdrawableAmount - vault's withdrawable amount, vaultImpl.getWithdrawableAmount()
 * @param totalSupply - vault's total lp supply
 * @returns
 */
function getAmountByShare(share, withdrawableAmount, totalSupply) {
    return totalSupply.isZero() ? new bn_js_1.default(0) : share.mul(withdrawableAmount).div(totalSupply);
}
exports.getAmountByShare = getAmountByShare;
/**
 *
 * @param amount - amount of desired underlying token to unstake
 * @param withdrawableAmount - vault's withdrawable amount, vaultImpl.getWithdrawableAmount()
 * @param totalSupply - vault's total lp supply, vaultImpl.lpSupply
 * @returns BN
 */
function getUnmintAmount(amount, withdrawableAmount, totalSupply) {
    return amount.mul(totalSupply).div(withdrawableAmount);
}
exports.getUnmintAmount = getUnmintAmount;
/**
 * `calculateWithdrawableAmount` calculates the amount of funds that can be withdrawn from a vault with vault state provided
 * @param {number} onChainTime - the current time on the blockchain
 * @param {VaultState} vaultState - VaultState
 * @returns The amount of the vault that can be withdrawn.
 */
function calculateWithdrawableAmount(onChainTime, vaultState) {
    const { lockedProfitTracker: { lastReport, lockedProfitDegradation, lastUpdatedLockedProfit }, totalAmount: vaultTotalAmount, } = vaultState;
    const duration = new bn_js_1.default(onChainTime).sub(lastReport);
    const lockedFundRatio = duration.mul(lockedProfitDegradation);
    if (lockedFundRatio.gt(constants_1.LOCKED_PROFIT_DEGRADATION_DENOMINATOR)) {
        return vaultTotalAmount;
    }
    const lockedProfit = lastUpdatedLockedProfit
        .mul(constants_1.LOCKED_PROFIT_DEGRADATION_DENOMINATOR.sub(lockedFundRatio))
        .div(constants_1.LOCKED_PROFIT_DEGRADATION_DENOMINATOR);
    return vaultTotalAmount.sub(lockedProfit);
}
exports.calculateWithdrawableAmount = calculateWithdrawableAmount;
//# sourceMappingURL=index.js.map