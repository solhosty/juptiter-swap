{"version":3,"file":"optimist.esm.js","sources":["../src/tx/errors.ts","../src/tx/poll.ts","../src/utils/deserializeAccount.ts","../src/utils/deserializeMint.ts","../src/utils/wrapSOL.ts"],"sourcesContent":["import { TOKEN_PROGRAM_ID } from '@solana/spl-token';\nimport { TransactionResponse, VersionedTransactionResponse } from '@solana/web3.js';\n\ntype IntrusctionError = [index: number, errorMsg: string];\ntype CustomInstructionError = [index: number, code: { Custom: number }];\ninterface ITransactionError {\n  InstructionError: CustomInstructionError | IntrusctionError;\n}\n\ninterface IInsufficientFundsForRent {\n  InsufficientFundsForRent: {\n    account_index: number;\n  };\n}\n\nexport class TransactionError extends Error {\n  constructor(m: string, public txid?: string, public code?: number, public programIds?: string[]) {\n    super(m);\n\n    // Set the prototype explicitly.\n    Object.setPrototypeOf(this, Error.prototype);\n  }\n}\nexport const PROGRAM_FAILED_TO_COMPLETE_ERROR = 'Program failed to complete';\nexport const UNKNOWN_ERROR = 'Unknown error, visit the explorer';\nconst SYSTEM_PROGRAM_ID = '11111111111111111111111111111111';\n\nexport function parseErrorForTransaction(tx: VersionedTransactionResponse | TransactionResponse): {\n  message: string;\n  programIds?: string[];\n  code?: number;\n} {\n  // Easy case, logMessages has an obvious error message. From dapp-scaffold\n  const errors: string[] = [];\n  if (tx?.meta && tx.meta.logMessages) {\n    tx.meta.logMessages.forEach((log) => {\n      const regex = /Error: (.*)/gm;\n      let m;\n      while ((m = regex.exec(log)) !== null) {\n        // This is necessary to avoid infinite loops with zero-width matches\n        if (m.index === regex.lastIndex) {\n          regex.lastIndex++;\n        }\n\n        if (m.length > 1) {\n          errors.push(m[1]);\n        }\n      }\n    });\n  }\n  if (errors.length > 0) {\n    return { message: errors.join(',') };\n  }\n\n  // Harder case, we need to dig for a custom code\n  const transactionError = tx?.meta?.err;\n  let errorCode;\n\n  if (transactionError && typeof transactionError !== 'string') {\n    let error = transactionError as ITransactionError | IInsufficientFundsForRent;\n\n    if ('InsufficientFundsForRent' in error) {\n      return {\n        message: 'Insufficient funds for rent',\n        code: 1,\n        programIds: [TOKEN_PROGRAM_ID.toBase58()],\n      };\n    } else {\n      const instructionError = (transactionError as ITransactionError).InstructionError;\n\n      const [index, errorMsg] = instructionError;\n\n      if (typeof errorMsg === 'string') {\n        if (errorMsg === 'ProgramFailedToComplete') {\n          if (tx?.meta && tx.meta.logMessages) {\n            const failedProgramIds = getFailedExceededInstructionsPrograms(tx.meta?.logMessages);\n            if (failedProgramIds.length > 0) {\n              return {\n                message: PROGRAM_FAILED_TO_COMPLETE_ERROR,\n                programIds: failedProgramIds,\n                code: errorCode,\n              };\n            }\n          }\n        }\n      } else {\n        errorCode = errorMsg.Custom ?? (instructionError[1] as any as number);\n\n        if (tx?.meta && tx.meta.logMessages) {\n          const failedProgramId = getFailedProgram(tx.meta?.logMessages, errorCode);\n          if (failedProgramId) {\n            if (failedProgramId === SYSTEM_PROGRAM_ID) {\n              return getSystemProgramError(instructionError as CustomInstructionError);\n            }\n\n            return {\n              message: UNKNOWN_ERROR,\n              programIds: [failedProgramId],\n              code: errorCode,\n            };\n          }\n        }\n      }\n    }\n  }\n\n  return { message: typeof transactionError === 'string' ? transactionError : UNKNOWN_ERROR, code: errorCode };\n}\n\nfunction getFailedExceededInstructionsPrograms(logMessages: String[]) {\n  let founds = [];\n  for (let i = 0; i < logMessages.length; i++) {\n    const log = logMessages[i];\n\n    const found = log.match(new RegExp(/Program (\\S+) failed: Program failed to complete/));\n\n    if (found) {\n      founds.push(found[1]);\n    }\n  }\n\n  return founds;\n}\n\nfunction getFailedProgram(logMessages: String[], errorCode: number) {\n  for (let i = 0; i < logMessages.length; i++) {\n    const log = logMessages[i];\n\n    const found = log.match(\n      new RegExp(`Program ([1-9A-HJ-NP-Za-km-z]{32,44}) failed: custom program error: 0x${errorCode.toString(16)}`),\n    );\n\n    if (found) {\n      return found[1];\n    }\n  }\n\n  return;\n}\n\nfunction getSystemProgramError(instructionError: CustomInstructionError) {\n  const code = instructionError[1].Custom;\n\n  let message = '';\n  switch (code) {\n    // https://github.com/solana-labs/solana/blob/22a18a68e3ee68ae013d647e62e12128433d7230/sdk/program/src/system_instruction.rs#L12-L26\n    // TODO: Do we need to translate all error codes.\n    case 0: {\n      message = 'An account with the same address already exists';\n      break;\n    }\n    case 1: {\n      message = 'The account does not have enough SOL to perform the operation';\n      break;\n    }\n    default: {\n      message = UNKNOWN_ERROR;\n    }\n  }\n\n  return {\n    code,\n    programIds: [SYSTEM_PROGRAM_ID],\n    message,\n  };\n}\n","import { Connection, TransactionResponse, TransactionSignature } from '@solana/web3.js';\nimport { TransactionError } from './errors';\nimport promiseRetry from 'promise-retry';\n\nexport async function pollForConfirmedTransaction(\n  connection: Connection,\n  txid: TransactionSignature,\n): Promise<TransactionResponse | null> {\n  return promiseRetry(\n    async (retry) => {\n      const response = await connection.getTransaction(txid, {\n        commitment: 'confirmed',\n      });\n      if (!response) {\n        retry(new TransactionError('Transaction was not confirmed', txid));\n      }\n      return response;\n    },\n    {\n      retries: 30,\n      minTimeout: 500,\n    },\n  ).catch(() => null);\n}\n","import { AccountInfo, AccountLayout, u64 } from '@solana/spl-token';\nimport { PublicKey } from '@solana/web3.js';\n\nexport const deserializeAccount = (data: Buffer | undefined): AccountInfo | undefined => {\n  if (data == undefined || data.length == 0) {\n    return undefined;\n  }\n\n  const accountInfo = AccountLayout.decode(data);\n  accountInfo.mint = new PublicKey(accountInfo.mint);\n  accountInfo.owner = new PublicKey(accountInfo.owner);\n  accountInfo.amount = u64.fromBuffer(accountInfo.amount);\n\n  if (accountInfo.delegateOption === 0) {\n    accountInfo.delegate = null;\n    accountInfo.delegatedAmount = new u64(0);\n  } else {\n    accountInfo.delegate = new PublicKey(accountInfo.delegate);\n    accountInfo.delegatedAmount = u64.fromBuffer(accountInfo.delegatedAmount);\n  }\n\n  accountInfo.isInitialized = accountInfo.state !== 0;\n  accountInfo.isFrozen = accountInfo.state === 2;\n\n  if (accountInfo.isNativeOption === 1) {\n    accountInfo.rentExemptReserve = u64.fromBuffer(accountInfo.isNative);\n    accountInfo.isNative = true;\n  } else {\n    accountInfo.rentExemptReserve = null;\n    accountInfo.isNative = false;\n  }\n\n  if (accountInfo.closeAuthorityOption === 0) {\n    accountInfo.closeAuthority = null;\n  } else {\n    accountInfo.closeAuthority = new PublicKey(accountInfo.closeAuthority);\n  }\n\n  return accountInfo;\n};\n","import { PublicKey } from '@solana/web3.js';\nimport { u64, MintInfo, MintLayout } from '@solana/spl-token';\n\n// Backward compatibility for new Mint.\ntype Mint = MintInfo & {\n  address?: PublicKey;\n};\n\nexport const deserializeMint = (data: Buffer, address?: PublicKey) => {\n  if (data.length !== MintLayout.span) {\n    // This is causing problem with mainnet token\n    // throw new Error('Not a valid Mint')\n    return;\n  }\n\n  const mintInfo = MintLayout.decode(data);\n  mintInfo.address = address;\n\n  if (mintInfo.mintAuthorityOption === 0) {\n    mintInfo.mintAuthority = null;\n  } else {\n    mintInfo.mintAuthority = new PublicKey(mintInfo.mintAuthority);\n  }\n\n  mintInfo.supply = u64.fromBuffer(mintInfo.supply);\n  mintInfo.isInitialized = mintInfo.isInitialized !== 0;\n\n  if (mintInfo.freezeAuthorityOption === 0) {\n    mintInfo.freezeAuthority = null;\n  } else {\n    mintInfo.freezeAuthority = new PublicKey(mintInfo.freezeAuthority);\n  }\n\n  return mintInfo as Mint;\n};\n","import { ASSOCIATED_TOKEN_PROGRAM_ID, TOKEN_PROGRAM_ID, Token } from '@solana/spl-token';\nimport { Connection, PublicKey, SystemProgram, Transaction } from '@solana/web3.js';\n\nconst SOL_MINT = 'So11111111111111111111111111111111111111112';\n\nasync function getWSolATA(connection: Connection, publicKey: PublicKey) {\n  const wSolAddress = await Token.getAssociatedTokenAddress(\n    ASSOCIATED_TOKEN_PROGRAM_ID,\n    TOKEN_PROGRAM_ID,\n    new PublicKey(SOL_MINT),\n    publicKey,\n  );\n  const accountInfo = await connection.getAccountInfo(wSolAddress);\n  return { address: wSolAddress, accountInfo };\n}\n\nasync function createAndTransferWSOLInstructions(\n  connection: Connection,\n  publicKey: PublicKey,\n  amountToTransferInLamports: number,\n) {\n  const wSolAccount = await getWSolATA(connection, publicKey);\n  const instructions = [];\n\n  // If no accountInfo, create one\n  if (!wSolAccount.accountInfo) {\n    // Create ATA account\n    instructions.push(\n      Token.createAssociatedTokenAccountInstruction(\n        ASSOCIATED_TOKEN_PROGRAM_ID,\n        TOKEN_PROGRAM_ID,\n        new PublicKey(SOL_MINT),\n        wSolAccount.address,\n        publicKey,\n        publicKey,\n      ),\n    );\n  }\n\n  // Fund account and sync\n  instructions.push(\n    SystemProgram.transfer({\n      fromPubkey: publicKey,\n      toPubkey: wSolAccount.address,\n      lamports: amountToTransferInLamports,\n    }),\n  );\n  instructions.push(\n    // This is not exposed by the types, but indeed it exists\n    (Token as any).createSyncNativeInstruction(TOKEN_PROGRAM_ID, wSolAccount.address),\n  );\n\n  const { blockhash, lastValidBlockHeight } = await connection.getLatestBlockhash();\n  const transaction = new Transaction({ feePayer: publicKey, blockhash, lastValidBlockHeight });\n  transaction.add(...instructions);\n  return transaction;\n}\n\nasync function createUnwrapSolInstructions(connection: Connection, publicKey: PublicKey) {\n  const wSolAccount = await getWSolATA(connection, publicKey);\n  const instructions = [];\n\n  if (!wSolAccount.accountInfo) {\n    return;\n  }\n  // Close account\n  instructions.push(\n    Token.createCloseAccountInstruction(TOKEN_PROGRAM_ID, wSolAccount.address, publicKey, publicKey, []),\n  );\n\n  const { blockhash, lastValidBlockHeight } = await connection.getLatestBlockhash();\n  const transaction = new Transaction({ feePayer: publicKey, blockhash, lastValidBlockHeight });\n  transaction.add(...instructions);\n  return transaction;\n}\n\nexport { createAndTransferWSOLInstructions, createUnwrapSolInstructions };\n"],"names":["TransactionError","Error","constructor","m","txid","code","programIds","Object","setPrototypeOf","prototype","PROGRAM_FAILED_TO_COMPLETE_ERROR","UNKNOWN_ERROR","SYSTEM_PROGRAM_ID","parseErrorForTransaction","tx","errors","meta","logMessages","forEach","log","regex","exec","index","lastIndex","length","push","message","join","transactionError","err","errorCode","error","TOKEN_PROGRAM_ID","toBase58","instructionError","InstructionError","errorMsg","failedProgramIds","getFailedExceededInstructionsPrograms","Custom","failedProgramId","getFailedProgram","getSystemProgramError","founds","i","found","match","RegExp","toString","pollForConfirmedTransaction","connection","promiseRetry","retry","response","getTransaction","commitment","retries","minTimeout","catch","deserializeAccount","data","undefined","accountInfo","AccountLayout","decode","mint","PublicKey","owner","amount","u64","fromBuffer","delegateOption","delegate","delegatedAmount","isInitialized","state","isFrozen","isNativeOption","rentExemptReserve","isNative","closeAuthorityOption","closeAuthority","deserializeMint","address","MintLayout","span","mintInfo","mintAuthorityOption","mintAuthority","supply","freezeAuthorityOption","freezeAuthority","SOL_MINT","getWSolATA","publicKey","wSolAddress","Token","getAssociatedTokenAddress","ASSOCIATED_TOKEN_PROGRAM_ID","getAccountInfo","createAndTransferWSOLInstructions","amountToTransferInLamports","wSolAccount","instructions","createAssociatedTokenAccountInstruction","SystemProgram","transfer","fromPubkey","toPubkey","lamports","createSyncNativeInstruction","blockhash","lastValidBlockHeight","getLatestBlockhash","transaction","Transaction","feePayer","add","createUnwrapSolInstructions","createCloseAccountInstruction"],"mappings":"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"}